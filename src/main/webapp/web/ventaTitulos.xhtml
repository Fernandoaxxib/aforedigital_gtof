<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<ui:composition template="layout3.xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets">

	<f:metadata>
		<f:event listener="#{ventaTitulos.iniciar}" type="preRenderView" />
	</f:metadata>

	<ui:define name="menu">
		<ui:include src="menu.xhtml" />
	</ui:define>

	<ui:define name="submenu">
		<ui:include src="subMenuTransacciones.xhtml" />
	</ui:define>



	<ui:define name="center">
		<h:outputScript name="js/calendar-localization.js" />

		<h:form id="form">
			<p:panel id="busqueda"
				header="VENTA DE TÍTULO POR SECTOR DE INVERSIÓN">
				<p:panelGrid id="pBusqueda" styleClass="ui-noborder">

					<p:row>
						<p:column colspan="2">
							<p:panelGrid id="fechas">
								<p:row>
									<p:column colspan="4">
										<p:outputLabel value="Fecha de corte" />
									</p:column>
								</p:row>

								<p:row>
									<p:column>
										<p:outputLabel value="Inicio:" />
									</p:column>
									<p:column>
										<p:datePicker id="fechaInicial" yearNavigator="true"
											monthNavigator="true"
											inputStyle="width:120px; text-align:right;"
											value="#{ventaTitulos.fechaInicial}" showIcon="true"
											locale="es" pattern="dd-MM-yyyy"
											mindate="#{ventaTitulos.fechaActual}" readonlyInput="true" />
									</p:column>

									<p:column>
										<p:outputLabel value="Fin:" />
									</p:column>
									<p:column>
										<p:datePicker id="fechaFinal" yearNavigator="true"
											monthNavigator="true" value="#{ventaTitulos.fechaFinal}"
											inputStyle="width:120px; text-align:right;" showIcon="true"
											locale="es" pattern="dd-MM-yyyy"
											mindate="#{ventaTitulos.fechaActual}" readonlyInput="true" />
									</p:column>
								</p:row>
							</p:panelGrid>
						</p:column>
					</p:row>
					<p:row>
						<p:column>
							<p:outputPanel id="customPanel">
								<p:selectOneRadio id="customRadio"
									value="#{ventaTitulos.opcion}" layout="custom">
									<p:ajax update="customPanel"
										listener="#{ventaTitulos.changeOpcion}" />
									<f:selectItem itemLabel="Todos" itemValue="T" />
									<f:selectItem itemLabel="Retiros" itemValue="R" />
									<f:selectItem itemLabel="Traspasos" itemValue="A" />
									<f:selectItem itemLabel="Lote" itemValue="V" />
									<f:selectItem itemLabel="Lote Corte" itemValue="L" />
								</p:selectOneRadio>

								<p:panelGrid columns="3" cellpadding="5">
									<p:radioButton id="opt1" for="customRadio" itemIndex="0" />
									<h:outputLabel for="opt1" value="Todos los módulos" />
									<h:outputLabel value="" />

									<p:radioButton id="opt2" for="customRadio" itemIndex="1" />
									<h:outputLabel for="opt2" value="Retiros" />
									<p:selectOneMenu id="comboRetiros" style="width:200px" var="t"
										disabled="#{ventaTitulos.disRetiros}"
										converter="selectOneMenuConverter"
										value="#{ventaTitulos.selectedTipoRetiro}">
										<f:selectItem itemLabel="#{msg.modDesParc_combo_default}"
											itemValue="#{null}" noSelectionOption="true" />
										<f:selectItems value="#{ventaTitulos.tipoRetiros}" var="c"
											itemLabel="#{c.descripcion}" itemValue="#{c}" />

										<p:column>
											<f:facet name="header">
												<h:outputText value="Descripción" />
											</f:facet>
											<h:outputText value="#{t.descripcion}" />
										</p:column>
										<p:column>
											<f:facet name="header">
												<h:outputText value="Monto" />
											</f:facet>
											<h:outputText value="#{t.montoMovimiento}" style="float:right">
												<f:convertNumber type="currency" currencySymbol="$"
													minFractionDigits="6" />
											</h:outputText>
										</p:column>
									</p:selectOneMenu>

									<p:radioButton id="opt3" for="customRadio" itemIndex="2" />
									<h:outputLabel for="opt3" value="Traspasos afore-afore" />
									<p:selectOneMenu id="comboTraspasos" style="width:200px"
										var="t" disabled="#{ventaTitulos.disTraspasos}"
										converter="selectOneMenuConverter"
										value="#{ventaTitulos.selectedLoteTraspaso}">
										<f:selectItem itemLabel="#{msg.modDesParc_combo_default}"
											itemValue="#{null}" noSelectionOption="true" />
										<f:selectItems value="#{ventaTitulos.loteTraspasos}" var="c"
											itemLabel="#{c.idLote}" itemValue="#{c}" />

										<p:column>
											<f:facet name="header">
												<h:outputText value="Lote" />
											</f:facet>
											<h:outputText value="#{t.idLote}" />
										</p:column>
										<p:column>
											<f:facet name="header">
												<h:outputText value="Monto" />
											</f:facet>
											<h:outputText value="#{t.montoMovimiento}" style="float:right">
												<f:convertNumber type="currency" currencySymbol="$"
													minFractionDigits="6" />
											</h:outputText>
										</p:column>
									</p:selectOneMenu>

									<p:radioButton id="opt4" for="customRadio" itemIndex="3" />
									<h:outputLabel for="opt4" value="Dev. pago exceso lote" />
									<p:selectOneMenu id="comboDev" style="width:200px" var="t"
										disabled="#{ventaTitulos.disDev}"
										converter="selectOneMenuConverter"
										value="#{ventaTitulos.selectedrgDevExces}">
										<f:selectItem itemLabel="#{msg.modDesParc_combo_default}"
											itemValue="#{null}" noSelectionOption="true" />
										<f:selectItems value="#{ventaTitulos.rgDevExces}" var="c"
											itemLabel="#{c.idLote}" itemValue="#{c}" />

										<p:column>
											<f:facet name="header">
												<h:outputText value="Lote" />
											</f:facet>
											<h:outputText value="#{t.idLote}" />
										</p:column>
										<p:column>
											<f:facet name="header">
												<h:outputText value="Monto" />
											</f:facet>
											<h:outputText value="#{t.montoMovimiento}" style="float:right">
												<f:convertNumber type="currency" currencySymbol="$"
													minFractionDigits="6" />
											</h:outputText>
										</p:column>
									</p:selectOneMenu>

									<p:radioButton id="opt5" for="customRadio" itemIndex="4" />
									<h:outputLabel for="opt5" value="Lote corte" />
									<p:inputText id="inputLote" value="#{ventaTitulos.lote}"
										placeholder="Lote..." maxlength="11"
										disabled="#{ventaTitulos.disLote}" style="width:215px"></p:inputText>
								</p:panelGrid>
							</p:outputPanel>
						</p:column>
						<p:column style="vertical-align: bottom;">
							<p:commandButton class="blue"
								update="pBusqueda ventaTable result" style="margin-bottom:6px"
								actionListener="#{ventaTitulos.buscarMontos}" value="Buscar" />

							<p:commandButton class="blue" id="venta" update="result"
								actionListener="#{ventaTitulos.ventaTitulosMonitor}"
								style="margin-left:20px;margin-bottom:6px;"
								disabled="#{!ventaTitulos.mostrarVenta}" value="Venta monitor" />

							<p:commandButton class="blue" id="ventaCT" update="result"
								actionListener="#{ventaTitulos.ventaTitulosMonitorCT}"
								style="margin-left:20px;margin-bottom:6px;"
								disabled="#{!ventaTitulos.mostrarVentaCT}"
								value="Venta corte" />
						</p:column>


					</p:row>

				</p:panelGrid>

				<p:dataTable id="ventaTable" var="ven" paginatorPosition="bottom"
					emptyMessage="#{ventaTitulos.mensajeTabla}"
					value="#{ventaTitulos.montos}" rows="5" paginator="true"
					rowsPerPageTemplate="5,10,15"
					selection="#{ventaTitulos.selectedSiefore}" rowKey="#{ven.siefore}">

					<p:ajax event="rowSelectRadio" update="form:venta form:ventaCT" />
					<p:column selectionMode="single"
						style="width:20px;text-align:center" />

					<f:facet name="header" style="float:right">

						<h:outputLabel for="registros"
							value="#{msg.aprob_label_totalRegistros}" />
						<h:outputText id="totalRegistros"
							value="#{ventaTitulos.tablaCount}" />

					</f:facet>

					<p:column headerText="Siefore">
						<h:outputText value="#{ven.siefore}" />
					</p:column>

					<p:column headerText="Monto total">
						<h:outputText value="#{ven.totVender}" style="float:right">
							<f:convertNumber type="currency" currencySymbol="$"
								minFractionDigits="6" />
						</h:outputText>
					</p:column>

					<p:column headerText="Valor cuota">
						<h:outputText value="#{ven.valCuota}" style="float:right">
							<f:convertNumber type="currency" currencySymbol="$"
								minFractionDigits="6" />
						</h:outputText>
					</p:column>

					<p:column headerText="Total cuotas">
						<h:outputText value="#{ven.totCuotas}" style="float:right">
							<f:convertNumber type="currency" currencySymbol="$"
								minFractionDigits="6" />
						</h:outputText>
					</p:column>

					<p:column headerText="Pesos fracción afore">
						<h:outputText value="#{ven.retiroAforeMND}" style="float:right">
							<f:convertNumber type="currency" currencySymbol="$"
								minFractionDigits="6" />
						</h:outputText>
					</p:column>

					<p:column headerText="Fracción afore">
						<h:outputText value="#{ven.retiroAforeTIT}" style="float:right">
							<f:convertNumber type="currency" currencySymbol="$"
								minFractionDigits="6" />
						</h:outputText>
					</p:column>

					<p:column headerText="Total cuotas vender">
						<h:outputText value="#{ven.totGeneralCuotas}" style="float:right">
							<f:convertNumber type="currency" currencySymbol="$"
								minFractionDigits="6" />
						</h:outputText>
					</p:column>
				</p:dataTable>

				<ui:include src="processResult.xhtml">
					<ui:param name="base" value="#{ventaTitulos}" />
				</ui:include>
			</p:panel>
		</h:form>

	</ui:define>

</ui:composition>